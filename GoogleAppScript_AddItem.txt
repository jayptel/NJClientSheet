var sheetId = 'replace 'YOUR_SPREADSHEET_ID' with your actual spreadsheet ID'; // Replace with your actual spreadsheet ID
var sheetName = 'Items'; // Replace with your sheet name

function getNextId() {
  var sheet = SpreadsheetApp.openById(sheetId).getSheetByName(sheetName);
  var data = sheet.getDataRange().getValues();
  
  if (data.length == 0) {
    return 'id1'; // Start with 'id1' if there are no existing items
  }
  
  var lastId = data[data.length - 1][0]; // Assuming ID is in the first column
  
  if (typeof lastId === 'string' && lastId.startsWith('id')) {
    var numericPart = parseInt(lastId.replace('id', ''), 10); // Extract the numeric part
    if (!isNaN(numericPart)) {
      var nextId = 'id' + (numericPart + 1); // Increment the numeric part and construct the next ID
      return nextId;
    }
  }
  
  return 'id1'; // Default to 'id1' if the last ID cannot be parsed
}

function doPost(e) {
  var result = { message: 'hello' };

  try {
    var jsonString = e.postData.contents;
    var data = JSON.parse(jsonString);

    if (data.action === 'addItem') {
      var nextId = getNextId();
      var values = [nextId, data.name, data.description, data.age];
      
      var sheet = SpreadsheetApp.openById(sheetId).getSheetByName(sheetName);
      
      // Append the values to the sheet
      sheet.appendRow(values);

      result.message = 'Success';
    } else {
      result.message = 'Invalid action';
    }
  } catch (error) {
    result.message = 'Error: ' + error.toString();
  }

  return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);
}
